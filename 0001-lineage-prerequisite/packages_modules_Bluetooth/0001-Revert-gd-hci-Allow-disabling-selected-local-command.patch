From 4cc083855eb4752ecfd2d6da45cae83c7ff2a119 Mon Sep 17 00:00:00 2001
From: Andy CrossGate Yan <GeForce8800Ultra@gmail.com>
Date: Mon, 20 Nov 2023 21:59:29 +0800
Subject: [PATCH] Revert "gd: hci: Allow disabling selected local commands"

This reverts commit 543afb3dd2e2b5aa4f1931a973eb7c7df634aa69.
---
 system/gd/hci/controller.cc | 12 ------------
 1 file changed, 12 deletions(-)

diff --git a/system/gd/hci/controller.cc b/system/gd/hci/controller.cc
index 09718dc..1a02aec 100644
--- a/system/gd/hci/controller.cc
+++ b/system/gd/hci/controller.cc
@@ -16,7 +16,6 @@
 
 #include "hci/controller.h"
 
-#include <android-base/strings.h>
 #include <bluetooth/log.h>
 #include <com_android_bluetooth_flags.h>
 
@@ -46,8 +45,6 @@ constexpr uint8_t kMinEncryptionKeySize = 7;  // #define MIN_ENCRYPTION_KEY_SIZE
 constexpr bool kDefaultVendorCapabilitiesEnabled = true;
 static const std::string kPropertyVendorCapabilitiesEnabled =
     "bluetooth.core.le.vendor_capabilities.enabled";
-static const char kPropertyDisabledCommands[] =
-    "bluetooth.hci.disabled_commands";
 
 constexpr bool kDefaultErroneousDataReportingEnabled = true;
 static const std::string kPropertyErroneousDataReportingEnabled =
@@ -342,15 +339,6 @@ struct Controller::impl {
     ErrorCode status = complete_view.GetStatus();
     log::assert_that(status == ErrorCode::SUCCESS, "Status {}", ErrorCodeText(status));
     local_supported_commands_ = complete_view.GetSupportedCommands();
-
-    if (auto disabledCommands = os::GetSystemProperty(kPropertyDisabledCommands)) {
-      for (const auto& command : android::base::Split(*disabledCommands, ",")) {
-        uint16_t index = std::stoi(command);
-        uint16_t byte_index = index / 10;
-        uint16_t bit_index = index % 10;
-        local_supported_commands_[byte_index] &= ~(1 << bit_index);
-      }
-    }
   }
 
   void read_local_extended_features_complete_handler(std::promise<void> promise, CommandCompleteView view) {
-- 
2.34.1

